containers:
  default:
    docker: gcr.io/shopify-docker-images/apps/production/web-platform-ci-node:10.18.0-yarn-1.21.1

shared:
  build-polaris: &build-polaris
    label: 'Build polaris'
    container: default
    timeout: 35m
    dependencies:
      - yarn
    run:
      - yarn run build
      - yarn pack
      - mv shopify-polaris-*.tgz "artifacts/shopify-polaris-${BUILDKITE_COMMIT}.tgz
    artifact_paths:
      - path: 'artifacts'
        required: true
  build-web: &build-web
    label: 'Build web'
    trigger: 'web-production-builder'
    depends_on: 'build-polaris'
    build:
      branch: master
      env:
        BUILD_COMMIT: 'shopify-polaris-${BUILDKITE_COMMIT}.tgz'

steps:
  - <<: *build-polaris
  - <<: *build-web
